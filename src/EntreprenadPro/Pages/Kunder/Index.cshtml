@page
@using EntreprenadPro.Helpers
@model EntreprenadPro.Pages.Kunder.IndexModel

<section class="mt-3">
  <div class="d-flex flex-column gap-3 mb-4">
    <form
      method="get"
      role="search"
      aria-label="Sök i kunder"
      up-target=".customers"
      up-history="true"
      up-autosubmit
      up-watch-event="input"
      up-watch-delay="500">
      <div class="input-group">
        <span class="input-group-text border-end-0 fs-4" aria-hidden="true">
          <i class="bi bi-search" aria-hidden="true"></i>
        </span>
        <label for="SearchTerm" class="visually-hidden">Sök kunder</label>
        <input
          type="search"
          asp-for="SearchTerm"
          class="form-control border-start-0 fs-4"
          placeholder="Sök kunder…"
          aria-label="Sök kunder"
          aria-controls="customersList"
          inputmode="search">
      </div>
    </form>
    <div class="d-grid">
      <a
        href="/Kunder/Skapa"
        up-layer="new modal"
        up-position="right"
        up-history="false"
        up-accept-location="/Kunder"
        up-on-accepted="up.reload('.customers')"
        class="btn btn-primary btn-lg d-flex align-items-center justify-content-center gap-2"
        aria-label="Lägg till ny kund">
        <i class="bi bi-plus-lg text-light fs-3" aria-hidden="true"></i>
      </a>
    </div>
  </div>
  <div class="customers"
       aria-live="polite"
       up-on-loading="this.setAttribute('aria-busy','true')"
       up-on-loaded="this.removeAttribute('aria-busy')">
    @if (!Model.Customers.Any())
    {
      <div class="text-center py-5" role="status" aria-live="polite">
        <i class="bi bi-people display-1 text-muted mb-3" aria-hidden="true"></i>
        <h3 class="h4 text-muted">Inga kunder hittades</h3>
        <p class="text-muted mb-3">Börja med att lägga till din första kund</p>
        <a
          href="/Kunder/Skapa"
          up-layer="new modal"
          up-position="right"
          up-history="false"
          up-accept-location="/Kunder"
          up-on-accepted="up.reload('.customers')"
          class="btn btn-primary"
          aria-label="Lägg till ny kund">
          <i class="bi bi-plus-lg me-2" aria-hidden="true"></i>
          Lägg till
        </a>
      </div>
    }
    else
    {
      <div id="customersList" class="row g-4">
        @foreach (var customer in Model.Customers)
        {
          var contact = !string.IsNullOrWhiteSpace(customer.PhoneNumber)
            ? customer.PhoneNumber
            : !string.IsNullOrWhiteSpace(customer.Email)
              ? customer.Email
              : "Ingen kontaktinfo";
          var location = !string.IsNullOrWhiteSpace(customer.City)
            ? customer.City
            : !string.IsNullOrWhiteSpace(customer.Address)
              ? customer.Address
              : "Ingen ort";

          <div class="col-12 col-md-6 col-lg-4">
            <div class="card h-100 shadow-sm">
              <a asp-page="./Details/Index"
                 up-follow
                 up-transition="move-left"
                 asp-route-id="@customer.Id"
                 class="card-body d-flex flex-column gap-3 text-decoration-none text-reset"
                 style="cursor: pointer;"
                 aria-label="Visa kund @customer.Name">
                <div class="d-flex justify-content-between align-items-start">
                  <h5 class="card-title fw-medium mb-0">@customer.Name</h5>
                  <span class="badge text-muted border">
                    @EnumHelper.GetDisplayName(customer.Type)
                  </span>
                </div>
                <div>
                  <small class="text-muted d-block">Kontakt</small>
                  <p class="mb-0">@contact</p>
                </div>
                <div>
                  <small class="text-muted d-block">Plats</small>
                  <p class="mb-0">@location</p>
                </div>
              </a>
            </div>
          </div>
        }
      </div>
    }
  </div>
</section>