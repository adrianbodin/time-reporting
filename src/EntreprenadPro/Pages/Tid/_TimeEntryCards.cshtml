@using System.Security.Claims
@model EntreprenadPro.Pages.Tid.Index

@if (!Model.TimeEntries.Any())
{
  <div class="text-center py-5">
    <i class="bi bi-calendar-x display-1 text-muted mb-3"></i>
    <h2 class="h4 text-muted">Inga tidrapporter för denna dagen</h2>
    <p class="text-muted">Lägg till en ny</p>
  </div>
}
else
{
  <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3">
    @foreach (var timeEntry in Model.TimeEntries)
    {
      <div class="col entry-@timeEntry.Id">
        <div class="card h-100 shadow-sm">
          <div class="card-body d-flex flex-column">
            <div class="d-flex align-items-start justify-content-between mb-2">
              <div class="me-2">
                <div class="fw-semibold text-truncate" title="@timeEntry.Project">@timeEntry.Project</div>
                <div class="small text-muted text-truncate" title="@timeEntry.WorkType">
                  <i class="bi bi-kanban me-1"></i>@timeEntry.WorkType
                </div>
              </div>
              <span class="badge bg-secondary flex-shrink-0">@timeEntry.Hours h</span>
            </div>

            @if (!string.IsNullOrWhiteSpace(timeEntry.Description))
            {
              <p class="text-muted small mb-3"
                 style="display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;">
                @timeEntry.Description
              </p>
            }

            <div class="mt-auto">
              <div class="d-flex flex-wrap gap-2 small text-muted mb-3">
                <span class="me-3"><i class="bi bi-person me-1"></i>@timeEntry.EmployeeName</span>
                <span><i class="bi bi-calendar3 me-1"></i>@timeEntry.Date.ToString("MMMM dd, yyyy")</span>
              </div>

              @if (timeEntry.EmployeeId == User.FindFirstValue(ClaimTypes.NameIdentifier))
              {
                <div class="d-flex gap-2 justify-content-end">
                  <a asp-page="Redigera"
                     asp-route-id="@timeEntry.Id"
                     up-layer="new drawer"
                     up-position="right"
                     up-history="false"
                     up-accept-location="/tid"
                     up-on-accepted="up.reload('.entries')"
                     class="btn btn-sm btn-outline-primary">
                    <i class="bi bi-pencil"></i>
                    <span class="d-none d-md-inline ms-1">Redigera</span>
                  </a>
                  <form
                    method="post"
                    asp-page="Index"
                    asp-page-handler="DeleteEntry"
                    asp-route-id="@timeEntry.Id"
                    asp-route-selectedDate="@Model.SelectedDate.ToString("yyyy-MM-dd")"
                    up-confirm="Are you sure you want to delete this entry?"
                    up-target=".entries"
                    class="d-inline">
                    @Html.AntiForgeryToken()
                    <button class="btn btn-sm btn-outline-danger" type="submit">
                      <i class="bi bi-trash"></i>
                      <span class="d-none d-md-inline ms-1">Radera</span>
                    </button>
                  </form>
                </div>
              }
            </div>
          </div>
        </div>
      </div>
    }
  </div>
}
