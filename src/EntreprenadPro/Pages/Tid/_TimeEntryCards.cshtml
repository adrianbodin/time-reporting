@using EntreprenadPro.Helpers
@model EntreprenadPro.Pages.Tid.Index

@if (!Model.TimeEntries.Any())
{
  <div class="text-center py-5">
    <i class="bi bi-calendar-x display-1 text-muted mb-3"></i>
    <h2 class="h4 text-muted">Inga tidrapporter för denna dagen</h2>
    <p class="text-muted">Lägg till en ny</p>
  </div>
}
else
{
  <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3">
    @foreach (var timeEntry in Model.TimeEntries)
    {
      <div class="col entry-@timeEntry.Id">
        <div class="card h-100 shadow-sm">
          <div class="card-body d-flex flex-column position-relative">
            <form
              method="post"
              asp-page="Index"
              asp-page-handler="DeleteEntry"
              asp-route-id="@timeEntry.Id"
              asp-route-selectedDate="@Model.SelectedDate.ToString("yyyy-MM-dd")"
              up-confirm="Are you sure you want to delete this entry?"
              up-target=".entries"
              class="position-absolute"
              style="top:-0.5rem;right:-0.5rem;">
              @Html.AntiForgeryToken()
              <button class="btn border-0 opacity-50" type="submit">
                <i class="bi bi-x fs-1"></i>
              </button>
            </form>

            <div class="d-flex align-items-start justify-content-between mb-2">
              <div class="me-2">
                <div class="fw-semibold text-truncate"
                     title="@timeEntry.Project">@EnumHelper.GetDisplayName(timeEntry.Type)
                </div>
                <div class="small text-muted text-truncate" title="@timeEntry.WorkType">
                  <i class="bi bi-kanban me-1"></i>@timeEntry.WorkType
                </div>
              </div>
            </div>

            @if (!string.IsNullOrWhiteSpace(timeEntry.Description))
            {
              <p class="text-muted small mb-3"
                 style="display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;">
                @timeEntry.Description
              </p>
            }

            <div class="mt-auto">
              <div class="d-flex gap-2 justify-content-end">
                <a asp-page="Redigera"
                   asp-route-id="@timeEntry.Id"
                   up-layer="new drawer"
                   up-position="right"
                   up-history="false"
                   up-accept-location="/tid"
                   up-on-accepted="up.reload('.entries')"
                   class="btn btn-sm btn-outline-primary">
                  <i class="bi bi-pencil"></i>
                  <span class="d-none d-md-inline ms-1">Redigera</span>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    }
  </div>
}
